<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>Wireshark解密SSL的另一种方法</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, user-scalable=no"/>
    <meta name="renderer" content="webkit"/>
    <meta name="theme-color" content="#ffffff"/>
    <link rel="manifest" href="/manifest.json"/>
    <link href="/static/asciidoctor.min.css" rel="stylesheet"/>
    <link href="/static/build.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism.min.css" integrity="sha256-77qGXu2p8NpfcBpTjw4jsMeQnz0vyh74f5do0cWjQ/Q=" crossorigin="anonymous" />
</head>
<body>
<div id='app'>
    <header class="header">
        <div class="container">
            <!--start: Navigation -->
            <a href="/" class="brand">On the Road</a>
<!--            <ul class="nav">-->
<!--                <li><a href="/list/">Blogs</a></li>-->
<!--                <li><a href="/slides/">Slides</a></li>-->
<!--                <li><a href="/about/">About</a></li>-->
<!--            </ul>-->
        </div>
        <!--end: Navigation -->
        <div style="clear: both"></div>
        <search-bar v-if="isPageList"></search-bar>
    </header>

<section class="post-view">
    <article>
     
         <h1 class="post-title">Wireshark解密SSL的另一种方法</h1>
     
     <p>上篇文章简单提到了如何使用Wireshark抓取SSL流量，但Wireshark解密SSL除了需要有网站私钥，还只能对RSA这样的传统密钥交互机制进行解密，对于Google大力提倡的ECDHE_RSA这种<a href="https://en.wikipedia.org/wiki/Forward_secrecy">Forward secrecy</a>密钥交互协议就无效了（forward secrecy，前向安全或正向安全，就是设计来防止这种监听的，这不是Wireshark能够解决的问题）。</p>
<p>对于这种情况我们可以设定一个MITM proxies，比如<a href="http://www.fiddler2.com/fiddler2/">Fiddler</a>或<a href="http://mitmproxy.org/">mitmproxy</a>.</p>
<p>但还有个更简单的方法就是利用Chrome和Firefox的<code>SSLKEYLOGFILE</code>环境变量和Wireshark的(Pre)-Master-Secret功能:</p>
<ol>
<li>
<p>设定环境变量<br />
<code>export SSLKEYLOGFILE=/home/user/premaster.txt</code><br />
Windows在系统属性-&gt;高级-&gt;环境变量中设置。</p>
</li>
<li>
<p>设置Wireshark<br />
在Edit-&gt;Preferences-&gt;Protocols-&gt;SSL-&gt;(Pre)-Master-Secret log filename中指定刚才的premaster.txt文件。 <img src="images/premaster.png" alt="(Pre)-Master-Secret" /></p>
</li>
<li>
<p>正常打开Chrome或Firefox，访问HTTPS网站，你会看到premaster.txt里面记录了浏览器使用的临时密码，有了这个Wireshark自然可以解密SSL流量了。</p>
</li>
</ol>
<p>参考:<br />
<a href="https://wiki.wireshark.org/SSL">https://wiki.wireshark.org/SSL</a><br />
<a href="http://security.stackexchange.com/questions/35639/decrypting-tls-in-wireshark-when-using-dhe-rsa-ciphersuites/42350#42350">http://security.stackexchange.com/questions/35639/decrypting-tls-in-wireshark-when-using-dhe-rsa-ciphersuites/42350#42350</a><br />
<a href="https://jimshaver.net/2015/02/11/decrypting-tls-browser-traffic-with-wireshark-the-easy-way/">https://jimshaver.net/2015/02/11/decrypting-tls-browser-traffic-with-wireshark-the-easy-way/</a><br />
<a href="https://www.imperialviolet.org/2011/11/22/forwardsecret.html">https://www.imperialviolet.org/2011/11/22/forwardsecret.html</a><br />
<a href="https://www.imperialviolet.org/2012/06/25/wireshark.html">https://www.imperialviolet.org/2012/06/25/wireshark.html</a></p>

    </article>
    <section class="comment">
        <div id="disqus_thread"></div>
    </section>
</section>
<footer class="footer">
    Copyright © 2020 | Powered by <a href="https://github.com/chenhm/java-static-blog" target="_blank">java-static-blog</a>
</footer>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-core.min.js" integrity="sha256-Y+Budm2wBEjYjbH0qcJRmLuRBFpXd0VKxl6XhdS4hgA=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/keep-markup/prism-keep-markup.min.js" integrity="sha256-jHeLW+quLKoSpBFisYif0SQf9Z20AKgmKb2vcdWehJI=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js" integrity="sha256-ht8ay6ZTPZfuixYB99I5oRpCLsCq7Do2LjEYLwbe+X8=" crossorigin="anonymous"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39495276-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-39495276-1');
</script>

</body>
</html>